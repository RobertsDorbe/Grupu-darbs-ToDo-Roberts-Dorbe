<!DOCTYPE html>
<html lang="lv">
<head>
	<!-- Autors Roberts Dorbe
    Versija: v1
    -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<title>todo lists</title>
</head>
<body class="bg-light">
	<div class="container d-flex justify-content-center mt-5">
		<div class="card p-4 w-100" style="max-width:500px">
			<h3 class="text-center mb-3">Saraksts kas jāizdara</h3>
			<div class="mb-3">
				<div class="input-group">
					<select id="priority-select" class="form-select" style="max-width: 120px;">
						<option value="SVARĪGI">SVARĪGS</option>
						<option value="Vidējs">Vidējs</option>
						<option value="Zems">Zems</option>
					</select>
					<input id="task-input" type="text" class="form-control" placeholder="Ieraksti darbu">
					<button class="btn btn-primary" onclick="addTask()">Pievienot</button>
				</div>
			</div>
			<ul id="task-list" class="list-group"></ul>
		</div>
	</div>
<script>
const list=document.getElementById("task-list")
const input=document.getElementById("task-input")
const data=JSON.parse(localStorage.getItem("tasks")||"[]")
data.forEach(t=>createTask(typeof t === 'string' ? {text: t, done: false} : t))
function addTask(){
	if(!input.value.trim())return
	const priority=document.getElementById('priority-select').value
	const task={text: input.value, priority: priority, done:false}
	data.push(task)
	localStorage.setItem("tasks",JSON.stringify(data))
	createTask(task)
	input.value=""
}
function createTask(task){
	const li=document.createElement("li")
	li.className="list-group-item"
	const priorityLabel={SVARĪGI:"SVARĪGI", Vidējs:"Vidējs", Zems:"Zems"}[task.priority||"SVARĪGI"]
	const priorityColor={SVARĪGI:"danger", Vidējs:"warning", Zems:"secondary"}[task.priority||"SVARĪGI"]
	li.innerHTML=`
		<div class="d-flex align-items-center w-100">
			<input type="checkbox" class="form-check-input me-2" ${task.done? 'checked':''}>
			<span class="badge bg-${priorityColor} me-2">${priorityLabel}</span>
			<span class="flex-grow-1 ${task.done? 'text-decoration-line-through':''}">${escapeHtml(task.text)}</span>
			<button class="btn btn-danger btn-sm ms-2">Dzēst</button>
		</div>
	`
	const checkbox=li.querySelector('input[type="checkbox"]')
	const span=li.querySelector('span:nth-of-type(2)')
	checkbox.addEventListener('change', ()=>{
		span.classList.toggle('text-decoration-line-through', checkbox.checked)
		task.done=checkbox.checked
		localStorage.setItem("tasks",JSON.stringify(data))
	})
	span.addEventListener('click', ()=>{
		checkbox.checked = !checkbox.checked
		span.classList.toggle('text-decoration-line-through', checkbox.checked)
		task.done=checkbox.checked
		localStorage.setItem("tasks",JSON.stringify(data))
	})
	li.querySelector("button").onclick=()=>{
		const idx = data.indexOf(task)
		if(idx>-1) data.splice(idx,1)
		localStorage.setItem("tasks",JSON.stringify(data))
		li.remove()
	}
	list.appendChild(li)
}
function escapeHtml(unsafe) {
	return String(unsafe).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]})
}
</script>
</body>
</html>
